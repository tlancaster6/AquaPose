---
phase: 28-e2e-testing
task: 2
total_tasks: 2
status: in_progress
last_updated: 2026-02-28T00:41:59.700Z
---

<current_state>
Phase 28 plan 28-01 execution is mostly complete. Task 1 (write e2e tests) is done. Task 2 (human-verify checkpoint) was reached — user ran real-data tests, found and fixed multiple bugs inline, all 4 e2e tests now pass (2 synthetic, 2 real-data). Still need: SUMMARY.md creation, STATE.md update, ROADMAP.md update, and phase verification.
</current_state>

<completed_work>

- Task 1: Rewrite e2e tests — Done (commit b7adf90)
  - `tests/e2e/test_smoke.py` rewritten with TestSyntheticSmoke (2 tests, no @slow) and TestRealData (2 tests, @slow @e2e)
  - `tests/e2e/conftest.py` with session-scoped fixtures
  - Bug fix: SyntheticDataStage fish z-coordinate (placed above water surface)
- Task 2: Human-verify checkpoint — In progress, tests pass, several inline fixes applied:
  - Golden tests skipped (v1.0 modules deleted) — commit 4396f71
  - Conftest refactored to use `~/aquapose/testing/` convention — commit 182b0ae
  - MidlineConfig `device` kwarg removed — commit 0b6a5fa
  - **LUT auto-generation on cache miss** in AssociationStage — commit b413b51
  - **Midline2D reconstruction** fixed (arc_length removed, ndarray preserved) — commit b413b51
  - Persistent test output removed, all artifacts to tmp_path — commit 64a7f78
  - TrackletTrailObserver respects stop_frame — commit 272e221
  - Test videos trimmed to 300 frames in ~/aquapose/testing/videos/
</completed_work>

<remaining_work>

- Create `.planning/phases/28-e2e-testing/28-01-SUMMARY.md`
- Update STATE.md with phase 28 position and decisions
- Update ROADMAP.md with plan progress via `roadmap update-plan-progress`
- Run phase verification (gsd-verifier)
- Update ROADMAP.md to mark phase complete if verification passes
</remaining_work>

<decisions_made>

- Test data lives at `~/aquapose/testing/` with `AQUAPOSE_TEST_DATA` env var override — no hardcoded machine paths
- LUTs auto-generate on first use instead of requiring manual `build-luts` CLI command (which didn't exist)
- Golden tests skipped with pytestmark (not deleted) — need regeneration for v2.1
- E2e tests produce no persistent output — everything goes to pytest tmp_path
- Test videos trimmed to 300 frames (~10s at 30fps) for minimal test data bundle
</decisions_made>

<blockers>
- None — all 4 e2e tests pass
</blockers>

<context>
This was the first real execution of the full v2.1 5-stage pipeline. Multiple bugs surfaced and were fixed inline:
1. Synthetic fish placement (above water)
2. MidlineConfig schema mismatch (device kwarg)
3. Midline2D reconstruction (arc_length, list vs ndarray)
4. LUT dependency (silent empty output → auto-generate)

The pipeline now runs end-to-end on both synthetic and real data. Association produces tracklet groups, orientation is resolved, and 3D splines span 3+ contiguous frames on real data.

Bug ledger at `.planning/phases/28-e2e-testing/28-BUGS.md` has NB-001 (LUT requirement, now auto-fixed) and NB-002 (golden tests need regeneration).
</context>

<next_action>
Resume by running `/gsd:execute-phase 28` which will detect Task 1 as complete (SUMMARY.md missing though — may need manual SUMMARY creation first), then finish state/roadmap updates and verification. Or manually: create 28-01-SUMMARY.md, update STATE.md, run verifier.
</next_action>
