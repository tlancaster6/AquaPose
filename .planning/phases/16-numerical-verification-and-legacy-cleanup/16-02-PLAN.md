---
phase: 16-numerical-verification-and-legacy-cleanup
plan: 02
type: execute
wave: 2
depends_on: [16-01]
files_modified:
  - scripts/legacy/diagnose_pipeline.py
  - scripts/legacy/diagnose_tracking.py
  - scripts/legacy/diagnose_triangulation.py
  - scripts/legacy/per_camera_spline_overlay.py
  - scripts/legacy/__init__.py
  - tests/unit/pipeline/test_stages.py
autonomous: true
requirements: [VER-04]

must_haves:
  truths:
    - "Legacy diagnostic scripts (diagnose_pipeline.py, diagnose_tracking.py, diagnose_triangulation.py, per_camera_spline_overlay.py) are moved to scripts/legacy/"
    - "Training/dataset scripts (train_yolo.py, sample_yolo_frames.py, organize_yolo_dataset.py, build_training_data.py) remain in scripts/ untouched"
    - "generate_golden_data.py remains in scripts/ (updated in plan 16-01)"
    - "No active code (src/, tests/) imports from archived scripts"
    - "No active code imports from aquapose.pipeline.stages via the old v1.0 function API (run_detection, run_segmentation, etc.) — tests that used these are updated or removed"
    - "The test suite passes with zero references to the old script-based execution path"
  artifacts:
    - path: "scripts/legacy/diagnose_pipeline.py"
      provides: "Archived legacy diagnostic script"
    - path: "scripts/legacy/diagnose_tracking.py"
      provides: "Archived legacy tracking diagnostic"
    - path: "scripts/legacy/diagnose_triangulation.py"
      provides: "Archived legacy triangulation diagnostic"
    - path: "scripts/legacy/per_camera_spline_overlay.py"
      provides: "Archived legacy spline overlay visualization"
  key_links:
    - "No import path from src/ or tests/ reaches scripts/legacy/"
    - "tests/unit/pipeline/test_stages.py updated to remove v1.0 pipeline.stages imports"
---

<objective>
Archive legacy diagnostic scripts to scripts/legacy/ and clean up any remaining references to the old v1.0 script-based execution path.

Purpose: VER-04 requires all legacy scripts that duplicate or bypass pipeline functionality to be archived. This prevents confusion about which code path is canonical (answer: PosePipeline) and ensures no active code depends on the old orchestrator.

Output: Legacy scripts moved to scripts/legacy/, import audit clean, test suite passing with no v1.0 execution path references.
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-numerical-verification-and-legacy-cleanup/16-CONTEXT.md
@.planning/phases/16-numerical-verification-and-legacy-cleanup/16-01-SUMMARY.md

@scripts/diagnose_pipeline.py
@scripts/diagnose_tracking.py
@scripts/diagnose_triangulation.py
@scripts/per_camera_spline_overlay.py
@tests/unit/pipeline/test_stages.py

<interfaces>
Scripts to archive (per CONTEXT.md locked decision):
- scripts/diagnose_pipeline.py -> scripts/legacy/diagnose_pipeline.py
- scripts/diagnose_tracking.py -> scripts/legacy/diagnose_tracking.py
- scripts/diagnose_triangulation.py -> scripts/legacy/diagnose_triangulation.py
- scripts/per_camera_spline_overlay.py -> scripts/legacy/per_camera_spline_overlay.py

Scripts to KEEP (per CONTEXT.md locked decision):
- scripts/train_yolo.py (training purpose)
- scripts/sample_yolo_frames.py (dataset purpose)
- scripts/organize_yolo_dataset.py (dataset purpose)
- scripts/build_training_data.py (dataset purpose)
- scripts/generate_golden_data.py (updated in 16-01, stays in scripts/)

Known v1.0 import in tests:
- tests/unit/pipeline/test_stages.py imports from aquapose.pipeline.stages
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move legacy scripts to scripts/legacy/ and create archive marker</name>
  <files>
    scripts/legacy/__init__.py
    scripts/legacy/diagnose_pipeline.py
    scripts/legacy/diagnose_tracking.py
    scripts/legacy/diagnose_triangulation.py
    scripts/legacy/per_camera_spline_overlay.py
  </files>
  <action>
1. Create `scripts/legacy/` directory.

2. Create `scripts/legacy/__init__.py` with a docstring explaining these are archived v1.0 scripts that have been superseded by the PosePipeline engine. Include a note: "These scripts are preserved for reference only. They are NOT maintained and may not run against current code."

3. Move (git mv) these files:
   - `scripts/diagnose_pipeline.py` -> `scripts/legacy/diagnose_pipeline.py`
   - `scripts/diagnose_tracking.py` -> `scripts/legacy/diagnose_tracking.py`
   - `scripts/diagnose_triangulation.py` -> `scripts/legacy/diagnose_triangulation.py`
   - `scripts/per_camera_spline_overlay.py` -> `scripts/legacy/per_camera_spline_overlay.py`

4. Also check for `scripts/diagnose_triangulation.py` in the repo root (untracked per git status) — if it exists there, move it to `scripts/legacy/` as well.

5. Verify the remaining scripts in `scripts/` are only the keepers:
   - train_yolo.py
   - sample_yolo_frames.py
   - organize_yolo_dataset.py
   - build_training_data.py
   - generate_golden_data.py

  </action>
  <verify>
    <automated>ls scripts/legacy/ && ls scripts/*.py</automated>
    Legacy scripts exist in scripts/legacy/. Only keeper scripts remain in scripts/.
  </verify>
  <done>
    - scripts/legacy/ directory exists with 4 archived scripts + __init__.py
    - scripts/ contains only training/dataset scripts and generate_golden_data.py
    - git mv used for tracked files (preserves history)
  </done>
</task>

<task type="auto">
  <name>Task 2: Import audit and test cleanup</name>
  <files>
    tests/unit/pipeline/test_stages.py
  </files>
  <action>
1. Run an import audit: search all files under `src/` and `tests/` for imports from:
   - `aquapose.pipeline.stages` (v1.0 stage functions: run_detection, run_segmentation, etc.)
   - `scripts.diagnose_pipeline`, `scripts.diagnose_tracking`, `scripts.diagnose_triangulation`, `scripts.per_camera_spline_overlay`
   - Any direct import of archived script modules

2. For `tests/unit/pipeline/test_stages.py`:
   - This file imports `from aquapose.pipeline.stages import run_tracking, run_triangulation`.
   - Evaluate the test content. If these tests are testing the OLD v1.0 batch functions and there are now equivalent tests via the regression suite (16-01) or the interface tests in tests/golden/, then these tests are redundant.
   - If redundant: delete the test file entirely or gut it down to just confirm the module is still importable (the pipeline.stages module still exists — it's library code, not a script).
   - If the tests exercise unique behavior not covered by regression tests: update them to import from the new core/ stage modules instead.
   - Preferred approach: keep the file but replace v1.0 function tests with a simple importability check or delete the file if all value is covered by tests/golden/ and tests/regression/.

3. Re-run the import audit after changes to confirm zero references to archived scripts from src/ or tests/ (excluding scripts/legacy/ itself).

4. Run `hatch run test` (fast tests) to confirm nothing is broken.

  </action>
  <verify>
    <automated>hatch run test 2>&1 | tail -5</automated>
    Fast test suite passes. No import errors from removed/moved scripts.
  </verify>
  <done>
    - No file in src/ or tests/ imports from archived scripts
    - tests/unit/pipeline/test_stages.py cleaned up (v1.0 imports removed or replaced)
    - `hatch run test` passes
    - Import audit clean: `grep -r "diagnose_pipeline\|diagnose_tracking\|diagnose_triangulation\|per_camera_spline" src/ tests/` returns no hits (excluding scripts/legacy/)
  </done>
</task>

</tasks>

<verification>
1. `ls scripts/legacy/` — 4 legacy scripts present
2. `ls scripts/*.py` — only training/dataset/golden scripts remain
3. `grep -r "from aquapose.pipeline.stages import" tests/` — no v1.0 function imports
4. `grep -r "diagnose_pipeline\|diagnose_tracking\|diagnose_triangulation\|per_camera_spline" src/ tests/` — no references to archived scripts
5. `hatch run test` — fast test suite passes
6. `hatch run lint` — no lint errors
</verification>

<success_criteria>
- Legacy diagnostic scripts archived to scripts/legacy/
- Training/dataset scripts untouched in scripts/
- No active code imports from archived scripts
- Test suite passes with no v1.0 execution path references
- Import boundary is clean: the canonical execution path is PosePipeline only
</success_criteria>

<output>
After completion, create `.planning/phases/16-numerical-verification-and-legacy-cleanup/16-02-SUMMARY.md`
</output>
