---
phase: 04-per-fish-reconstruction
task: 2
total_tasks: 2
status: checkpoint_waiting
last_updated: 2026-02-21T05:01:46.234Z
---

<current_state>
Phase 04 execution is at Wave 3, Plan 04-03, Task 2 checkpoint (human-verify). All code is built and committed. The user is running `scripts/run_reconstruction.py` on real video data overnight. Awaiting holdout IoU results to either approve (close phase) or route to gap closure.
</current_state>

<completed_work>

- Plan 04-01: Differentiable Silhouette Renderer + Multi-Objective Loss - Done (3 commits)
  - `renderer.py`: RefractiveCamera + RefractiveSilhouetteRenderer (vertex pre-projection to NDC approach)
  - `loss.py`: soft_iou_loss, compute_angular_diversity_weights, multi_objective_loss
  - Downgraded torch to 2.9.1+cu128 for pytorch3d ABI compatibility
  - 38 new tests, 270 total passing
- Plan 04-02: FishOptimizer - Done (3 commits)
  - `optimizer.py`: FishOptimizer with 2-start first-frame, warm-start subsequent, Adam with per-param LR, gradient clipping, convergence early-stop
  - 12 new tests with MockRenderer, 282 total passing
- Plan 04-03 Task 1: Holdout validation + visual overlay utilities - Done
  - `validation.py`: evaluate_holdout_iou, run_holdout_validation, render_overlay
- Plan 04-03 Task 2: End-to-end reconstruction script - Done (code built)
  - `scripts/run_reconstruction.py`: full pipeline CLI
  - Checkpoint: awaiting human verification of holdout IoU results
</completed_work>

<remaining_work>

- Plan 04-03 Task 2: Checkpoint resolution — user reports holdout IoU results
- If approved (IoU >= 0.80, no camera < 0.60): create 04-03-SUMMARY.md, run phase verification
- If gaps found: route to gap-closure planning
</remaining_work>

<decisions_made>

- Vertex pre-projection approach for renderer (pre-project mesh vertices to NDC via RefractiveCamera, render with FoVOrthographicCameras) — avoids implementing full PyTorch3D camera interface
- Camera image size auto-derived from K matrix (H=2*cy, W=2*cx)
- Position LR 5x higher than other params in optimizer (per RESEARCH.md recommendation)
- MockRenderer (differentiable Gaussian blob) for optimizer unit tests — avoids GPU/pytorch3d dependency in tests
</decisions_made>

<blockers>
- Waiting on user to run reconstruction script overnight and report results
- Runtime is expected to be several hours for 50 frames with full holdout validation (analysis-by-synthesis is inherently slow — hundreds of gradient iterations per frame through refractive projection)
</blockers>

<context>
The execute-phase orchestrator is mid-Wave 3 with a checkpoint active. When resuming, the user will report holdout IoU results. The orchestrator should then either:
1. Resume the 04-03 executor agent to create SUMMARY.md (if approved)
2. Route to gap closure (if IoU targets not met)
Then continue with phase verification and roadmap update steps from the execute-phase workflow.

The reconstruction command the user is running:
```
hatch run python scripts/run_reconstruction.py --video-dir "C:/Users/tucke/Desktop/Aqua/AquaPose/videos/core_videos" --calibration-json "C:\Users\tucke\Desktop\Aqua\AquaPose\calibration.json" --output-dir "C:/Users/tucke/Desktop/Aqua/AquaPose/output/reconstruction" --n-frames 50 --detector yolo --yolo-weights "C:/Users/tucke/Desktop/Aqua/AquaPose/yolo/train_v2/weights/best.pt"
```
</context>

<next_action>
Start with: `/gsd:resume-work` — user reports holdout IoU results from overnight run. If approved, spawn continuation agent for 04-03 to create SUMMARY.md, then proceed with phase verification step from execute-phase workflow.
</next_action>
