---
phase: 02-segmentation-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/aquapose/segmentation/__init__.py
  - src/aquapose/segmentation/label_studio.py
  - tests/unit/segmentation/test_label_studio.py
  - pyproject.toml
  - scripts/_debug_mask.py
  - scripts/_test_single.py
  - scripts/diagnose_mog2.py
  - scripts/verify_mog2_recall.py
  - scripts/verify_pseudo_labels.py
  - scripts/visualize_pseudo_labels.py
  - scripts/rerun_sam2_on_images.py
  - scripts/run_pseudo_labels.py
  - scripts/test_mog2.py
  - scripts/test_sam2.py
autonomous: true
requirements:
  - SEG-03

must_haves:
  truths:
    - "Label Studio code is fully removed from the codebase"
    - "Debug and test scripts are deleted from scripts/"
    - "label-studio-converter and label-studio-sdk are removed from pyproject.toml"
    - "All remaining imports resolve and tests pass"
  artifacts:
    - path: "src/aquapose/segmentation/__init__.py"
      provides: "Updated public API without Label Studio symbols"
    - path: "pyproject.toml"
      provides: "Cleaned dependencies without label-studio-converter"
  key_links:
    - from: "src/aquapose/segmentation/__init__.py"
      to: "all remaining submodules"
      via: "import statements"
      pattern: "from \\.(detector|pseudo_labeler|model|crop|dataset|training) import"
---

<objective>
Delete all Label Studio code, remove debug/test scripts, and clean up dependencies.

Purpose: The pipeline no longer uses Label Studio for annotation (per CONTEXT.md decision). Debug scripts accumulated during Phase 02.1/02.1.1 exploration are ad-hoc and should be removed. This cleanup must happen first so subsequent plans work from a clean baseline.

Output: A lean segmentation module with no Label Studio references, no stale scripts, and passing tests.
</objective>

<execution_context>
@C:/Users/tucke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/tucke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-segmentation-pipeline/02-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete Label Studio module and clean dependencies</name>
  <files>
    src/aquapose/segmentation/label_studio.py
    tests/unit/segmentation/test_label_studio.py
    src/aquapose/segmentation/__init__.py
    pyproject.toml
  </files>
  <action>
1. Delete `src/aquapose/segmentation/label_studio.py` entirely.
2. Delete `tests/unit/segmentation/test_label_studio.py` entirely.
3. Update `src/aquapose/segmentation/__init__.py`:
   - Remove the import line: `from .label_studio import (export_to_label_studio, import_from_label_studio, to_coco_dataset,)`
   - Remove these symbols from `__all__`: `export_to_label_studio`, `import_from_label_studio`, `to_coco_dataset`
   - Keep `to_coco_dataset` — it will be moved to a different module in Plan 02. For now, move the `to_coco_dataset` function into `pseudo_labeler.py` (it converts AnnotatedFrame to COCO JSON, which belongs with pseudo-labeling). Update `__init__.py` to import `to_coco_dataset` from `.pseudo_labeler` instead.
4. Update `pyproject.toml`:
   - Remove `label-studio-converter` from dependencies (both main and dev sections).
   - Remove `label-studio-sdk` if present.
   - Keep `pycocotools` (still needed for COCO RLE encoding in `to_coco_dataset`).
5. Update `src/aquapose/segmentation/pseudo_labeler.py`:
   - Add the `to_coco_dataset` function (copy from `label_studio.py`). It depends on `pycocotools.mask` and `AnnotatedFrame` — both already available in pseudo_labeler.py's scope.
   - Add the necessary `import json` and `import pycocotools.mask as mask_util` imports.
6. Run `hatch run test` to verify no import errors or test failures.
  </action>
  <verify>
- `hatch run test` passes (all non-slow tests)
- `hatch run lint` passes
- `hatch run typecheck` passes
- `label_studio.py` and `test_label_studio.py` files do not exist
- `label-studio-converter` not in pyproject.toml
- `from aquapose.segmentation import to_coco_dataset` works in a Python REPL
  </verify>
  <done>Label Studio module deleted, to_coco_dataset preserved in pseudo_labeler.py, all tests and checks pass.</done>
</task>

<task type="auto">
  <name>Task 2: Delete debug and exploration scripts</name>
  <files>
    scripts/_debug_mask.py
    scripts/_test_single.py
    scripts/diagnose_mog2.py
    scripts/verify_mog2_recall.py
    scripts/verify_pseudo_labels.py
    scripts/visualize_pseudo_labels.py
    scripts/rerun_sam2_on_images.py
    scripts/run_pseudo_labels.py
    scripts/test_mog2.py
    scripts/test_sam2.py
  </files>
  <action>
Delete these scripts per CONTEXT.md cleanup decision ("Delete all debug/test scripts: _debug_mask.py, _test_single.py, diagnose_mog2.py, verify_mog2_recall.py, etc."):

- `scripts/_debug_mask.py`
- `scripts/_test_single.py`
- `scripts/diagnose_mog2.py`
- `scripts/verify_mog2_recall.py`
- `scripts/verify_pseudo_labels.py`
- `scripts/visualize_pseudo_labels.py`
- `scripts/rerun_sam2_on_images.py`
- `scripts/run_pseudo_labels.py` (will be replaced by build_training_data.py in Plan 02)
- `scripts/test_mog2.py`
- `scripts/test_sam2.py`

Keep these scripts (still needed):
- `scripts/build_training_data.py` — will be updated in Plan 02
- `scripts/eval_yolo_vs_mog2.py` — YOLO evaluation script from Phase 02.1.1
- `scripts/organize_yolo_dataset.py` — YOLO dataset organizer
- `scripts/sample_yolo_frames.py` — YOLO frame sampler
- `scripts/train_yolo.py` — YOLO training script

Run `hatch run lint` to verify no remaining imports reference deleted scripts.
  </action>
  <verify>
- Deleted scripts no longer exist in `scripts/` directory
- `scripts/build_training_data.py`, `scripts/eval_yolo_vs_mog2.py`, `scripts/organize_yolo_dataset.py`, `scripts/sample_yolo_frames.py`, `scripts/train_yolo.py` still exist
- `hatch run lint` passes
  </verify>
  <done>All debug/exploration scripts deleted. Only production-relevant scripts remain.</done>
</task>

</tasks>

<verification>
1. `hatch run check` (lint + typecheck) passes
2. `hatch run test` passes
3. No `label_studio` references in segmentation module (grep confirms)
4. Deleted scripts absent from filesystem
5. `to_coco_dataset` still importable from `aquapose.segmentation`
</verification>

<success_criteria>
- Zero Label Studio references in src/aquapose/segmentation/
- Zero stale debug scripts in scripts/
- label-studio-converter removed from pyproject.toml
- All existing tests pass (minus deleted label_studio tests)
- to_coco_dataset function preserved and importable
</success_criteria>

<output>
After completion, create `.planning/phases/02-segmentation-pipeline/02-01-SUMMARY.md`
</output>
